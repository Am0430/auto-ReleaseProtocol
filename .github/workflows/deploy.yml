name: 部署用户协议到S3

on:
    push:
          paths:
                  - 'source/user_agreement.md'  # 只有当源文件更新时触发

          jobs:
              deploy:
                    runs-on: ubuntu-latest
                        steps:
                                - name: 拉取代码
                                        uses: actions/checkout@v4

                                              - name: 安装pandoc（格式转换工具）
                                                      run: sudo apt-get install pandoc

                                                            - name: 将Markdown转换为HTML
                                                                    run: |
                                                                                pandoc source/user_agreement.md -o dist/yunmu13-useragreement.html \
                                                                                            --standalone \
                                                                                                        --metadata title="用户协议"

                                                                                                              - name: 配置AWS凭证
                                                                                                                      uses: aws-actions/configure-aws-credentials@v4
                                                                                                                              with:
                                                                                                                                          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
                                                                                                                                                    aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
                                                                                                                                                              aws-region: ap-southeast-1  # 替换为你的S3区域

                                                                                                                                                                    - name: 上传到S3指定路径
                                                                                                                                                                            run: |
                                                                                                                                                                                        aws s3 cp dist/yunmu13-useragreement.html \
                                                                                                                                                                                                    s3://你的桶名/yunmu13/mp/agreements/ \
                                                                                                                                                                                                                --acl public-read

                                                                                                                                                                                                                      - name: 刷新CloudFront缓存
                                                                                                                                                                                                                              run: |
                                                                                                                                                                                                                                          aws cloudfront create-invalidation \
                                                                                                                                                                                                                                                      --distribution-id ${{ secrets.CLOUDFRONT_DISTRIBUTION_ID }} \
                                                                                                                                                                                                                                                                  --paths "/yunmu13/mp/agreements/*"
